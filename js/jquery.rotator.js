(function(e){var t={speed:800,timeout:5e3,width:960,height:485,random:true,autorun:true,fx:"fade",nav:false};e.rotator=function(n,r){this.options=e.extend({},t,r||{});this.el=e(n);this.step=-1;this.current=0;this.previous=0;this.animating=false;this.intervalID=null;this.nav_left=e('<a href="javascript:void(0);" class="rotator-nav" id="rotator-left"><div></div></a>');this.nav_right=e('<a href="javascript:void(0);" class="rotator-nav" id="rotator-right"><div></div></a>');this.preloader=e('<div class="preloader_rotator"></div>');this.main_rotator=e('<div class="main_rotator"></div>');this.slides_rotator=e('<ul class="slides_rotator"></ul>');this.count=this.options.slides.length-1;this.init()};var n=e.rotator;n.fn=n.prototype={rotator:"0.1"};n.fn.extend=n.extend=e.extend;n.fn.extend({init:function(){this.preload();var e=this;this.nav_left.bind("click.rotator",function(){e.prev()});this.nav_right.bind("click.rotator",function(){e.next()})},add:function(t){if(t.length==0)return false;var n=[],r=this;this.count+=t.length-1;e.each(t,function(e,t){n.push('<li><div class="img_rotator"><a rel="nofollow" href="'+t.url+'" target="_parent _blank"><img src="'+t.img+'" width="'+r.options.width+'" height="'+r.options.height+'" alt="*" /></a></div></li>')});this.slides_rotator.append(n.join("")).find("li").css({position:"absolute","z-index":1,left:this.options.width})},preload:function(){this.el.html(this.preloader.append('<img src="img/ajax-loader.gif" width="32" alt="Загрузка..." />'));var t=0,n=[],r=this;this.slides=this.render().find("li").css({position:"absolute","z-index":1});this.main_rotator.css({display:"none"});this.slides_rotator.css({width:this.options.width,height:this.options.height});if(this.options.fx=="fade"){this.slides.css("opacity",0).eq(0).css({"z-index":2,opacity:1})}else{this.slides_rotator.css("overflow","hidden");this.slides.css("left",this.options.width).eq(0).css({"z-index":2,left:0})}for(i=0;i<=this.count;i++){n[i]=new Image;n[i].onload=function(){t++;if(t>=r.count){r.main_rotator.show();e(".rotator-nav").show();r.preloader.hide();if(r.options.autorun){r.start()}}};n[i].src=this.options.slides[i].img}},render:function(){this.el.append(this.main_rotator);if(this.options.nav){this.el.append(this.nav_left,this.nav_right);e(".rotator-nav").hide()}if(this.options.random){this.options.slides.sort(function(){return.5-Math.random()})}var t=[],n=this;e.each(this.options.slides,function(e,r){t.push('<li><div class="img_rotator"><a rel="nofollow" href="'+r.url+'" target="_parent _blank"><img src="'+r.img+'" width="'+n.options.width+'" height="'+n.options.height+'" alt="*" /></a></div></li>')});return this.slides_rotator.html(t.join("")).appendTo(this.main_rotator)},start:function(){var e=this;this.step=-1;this.intervalID=setInterval(function(){e.next()},this.options.timeout)},stop:function(){clearInterval(this.intervalID)},next:function(){if(this.animating)return false;this.step=-1;if(this.current>=this.count)this.current=-1;this.previous=this.current;this.current++;if(this.current==0)this.previous=this.count;this.run()},prev:function(){if(this.animating)return false;this.step=1;this.previous=this.current;this.current--;if(this.current<0)this.current=this.count;this.run()},run:function(){var t=this;this.animating=true;if(this.options.autorun)this.stop();if(this.options.fx=="fade"){this.slides.eq(this.previous).css("z-index",1).stop(true,true).animate({opacity:0},this.options.speed);this.slides.eq(this.current).css("z-index",2).stop(true,true).animate({opacity:1},this.options.speed,function(){t.animating=false})}else{this.slides.eq(this.previous).css("z-index",1).stop(true,true).animate({left:this.step*this.options.width},this.options.speed,function(){e(this).css("left",this.step*t.options.width)});var n=this.slides.eq(this.current);if(n.css("left").match(/([-\d]+)/)[1]!=-this.step*this.options.width){n.css("left",-this.step*this.options.width)}n.css({"z-index":2}).stop(true,true).animate({left:0},this.options.speed,function(){t.animating=false})}if(this.options.autorun)this.start()}});e.fn.rotator=function(t){if(typeof t=="string"){var r=e(this).data("rotator"),i=Array.prototype.slice.call(arguments,1);return r[t].apply(r,i)}else{return this.each(function(){var r=e(this).data("rotator");if(r){if(t){e.extend(r.options,t)}r.init()}else{e(this).data("rotator",new n(this,t))}})}}})(jQuery)